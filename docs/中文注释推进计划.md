# 项目中文注释全量推进计划（人工逐文件）

## 1. 目标
- 为项目自研代码文件补充高密度中文注释，目标是新人可以快速理解：
  - 模块职责；
  - 核心数据流；
  - 关键函数输入/输出；
  - 重要边界与错误处理。
- 注释策略：`几乎每段关键逻辑都有注释`，并尽量保持与代码行级对应。

## 2. 范围定义
- 纳入范围：项目自研源码（`VmProtect`、`VmEngine`、`demo` 下源码/配置类代码文件）。
- 排除范围：
  - 第三方代码：`VmProtect/capstone_sdk/*`；
  - 二进制与资源资产：`.so/.lib/.jar/.webp` 与 `assets` 二进制数据；
  - 非代码文档文件。

## 3. 当前统计
- 当前纳入范围文件总数：`161`（见 `docs/_code_files_scope.txt`）。

## 4. 批次计划
### 批次 1（已完成）
- `VmProtect/modules/base/core` 全部文件：
  - `zBitCodec.h/.cpp`
  - `zBytes.h/.cpp`
  - `zChecksum.h/.cpp`
  - `zCodec.h/.cpp`
  - `zHash.h/.cpp`
  - `zIo.h/.cpp`

### 批次 2（已完成）
- `VmProtect/modules/foundation`
- `VmProtect/modules/pipeline`

### 批次 3（进行中）
- `VmProtect/modules/patchbay`
- `VmProtect/modules/elfkit`

### 批次 4（待执行）
- `VmEngine/app/src/main/cpp`
- `VmEngine/app/src/main/java`
- `VmEngine/app/src/main/res`（代码型 xml）
- `demo/app/src/main/cpp|java|res`（代码型文件）

## 5. 质量准则
- 注释必须说明“为什么/做什么/边界是什么”，避免空洞注释。
- 不改变业务逻辑，仅增强可读性。
- 每个批次结束后执行：
  - `cmake --build VmProtect/cmake-build-debug --target VmProtect -j 12`
  - `python tools/run_delivery_check.py --project-root .`

## 6. 进度记录
- 2026-02-25：创建推进计划与文件范围清单，启动批次 1。
- 2026-02-25：完成批次 1（`VmProtect/modules/base/core` 12 个文件）高密度中文注释并通过构建与交付回归。
- 2026-02-25：推进批次 2，完成 `VmProtect/modules/foundation/core` 与 `VmProtect/modules/pipeline/core` 头文件注释增强。
- 2026-02-25：完成批次 2 代码文件注释收尾（`zPipelineCoverage.cpp`、`zPipelineExport.cpp`、`zPipelinePatch.cpp`），并再次通过构建与设备交付回归（`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 3 进入执行，完成 `VmProtect/modules/patchbay` 全模块高密度中文注释（foundation/format/domain/app），并通过构建与设备交付回归（`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 3 继续推进，完成 `VmProtect/modules/elfkit/api`（`zElfKit.h/.cpp`、`zPatchbayApi.h/.cpp`）高密度中文注释，并通过构建与设备交付回归（`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 3 继续推进，完成 `VmProtect/modules/elfkit/core` 的 `zElfTypes.h`、`zElfFile.h` 注释增强，并再次通过构建与设备交付回归（`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 3 继续推进，完成 `VmProtect/modules/elfkit/core` 的 `zFunctionFacade.cpp`、`zElfSymbols.cpp`、`zElf.cpp`、`zElfAbi.h` 注释增强；并开始 `VmProtect/modules/elfkit/patchbayModel` 校验子模块注释增强（`zPatchElfValidatorSegment.cpp`、`zPatchElfValidatorDynamic.cpp`、`zPatchElfValidatorSymbol.cpp`）。
- 2026-02-25：上述增量完成后再次执行构建与设备交付回归，结果 `route4_regression PASS`、`demo_smoke PASS`、`DELIVERY_GATE PASS`。
- 2026-02-25：继续完善 `VmProtect/modules/elfkit/patchbayModel` 校验入口层注释（`zPatchElfValidator.cpp`、`zPatchElfValidatorBase.cpp`），并再次完成构建 + 设备回归（`DELIVERY_GATE PASS`）。
- 2026-02-25：继续推进 `VmProtect/modules/elfkit/patchbayModel` 大文件注释增强，完成 `zPatchElfLayout.cpp`、`zPatchElfModel.cpp` 的高密度中文注释，并再次通过构建与设备交付回归（`DELIVERY_GATE PASS`）。
- 2026-02-25：继续推进 `VmProtect/modules/elfkit/patchbayModel` 基础文件注释增强，完成 `zPatchElfUtils.cpp`、`zSectionEntry.cpp`、`zPatchElfLoader.cpp`、`zPatchElfTypes.h`、`zPatchElfLoader.h`、`zProgramEntry.cpp`、`zProgramTable.cpp`、`zPatchElf.cpp`、`zSectionTable.cpp`，并再次通过构建与设备交付回归（`DELIVERY_GATE PASS`）。
- 2026-02-25：继续推进 `VmProtect/modules/elfkit/patchbayModel` 头文件注释增强，完成 `zPatchElfHeader.cpp/.h`、`zProgramEntry.h`、`zProgramTable.h`、`zSectionTable.h`，并再次通过构建与设备交付回归（`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 4 启动，完成 `VmEngine/app/src/main/cpp` 的 `zVmInitCore.cpp/.h`、`zFileBytes.cpp/.h`、`zPipelineConfig.cpp` 高密度中文注释，并再次通过构建与设备交付回归（`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 4 继续推进，完成 `VmEngine/app/src/main/cpp/zVmInitLifecycle.cpp`、`VmEngine/app/src/main/AndroidManifest.xml`、`demo/app/src/main/AndroidManifest.xml`、`VmEngine/app/src/main/res/layout/activity_main.xml`、`demo/app/src/main/res/layout/activity_main.xml` 注释增强，并再次通过构建与设备交付回归（`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 4 持续推进，完成 `VmEngine/settings.gradle`、`demo/settings.gradle`、`VmEngine/app/src/main/res/values/colors.xml`、`demo/app/src/main/res/values/colors.xml`、`VmEngine/app/src/main/res/values/strings.xml`、`demo/app/src/main/res/values/strings.xml`、`VmEngine/app/src/main/res/mipmap-anydpi/ic_launcher.xml`、`VmEngine/app/src/main/res/mipmap-anydpi/ic_launcher_round.xml`、`demo/app/src/main/res/mipmap-anydpi/ic_launcher.xml`、`demo/app/src/main/res/mipmap-anydpi/ic_launcher_round.xml`、`VmEngine/app/src/main/res/xml/backup_rules.xml`、`VmEngine/app/src/main/res/xml/data_extraction_rules.xml`、`demo/app/src/main/res/xml/backup_rules.xml`、`demo/app/src/main/res/xml/data_extraction_rules.xml`、`VmEngine/app/src/main/res/drawable/ic_launcher_foreground.xml`、`demo/app/src/main/res/drawable/ic_launcher_foreground.xml`、`VmEngine/app/src/main/res/drawable/ic_launcher_background.xml`、`demo/app/src/main/res/drawable/ic_launcher_background.xml`、`VmEngine/app/src/main/cpp/zElfTakeoverDynsym.cpp/.h` 注释增强，并再次通过构建与设备交付回归（`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 4 继续推进，完成 `VmEngine/app/src/main/cpp/zSymbolTakeover.cpp` 注释密度提升，并再次通过构建与设备交付回归（`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 4 继续推进，完成 `demo/app/src/main/cpp/zVmpBridge.cpp`、`VmEngine/app/src/main/cpp/zTypeManager.cpp` 注释密度提升，并再次通过构建与设备交付回归（`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 4 继续推进，完成 `VmEngine/app/src/main/cpp/zVmEngine.cpp` 注释密度提升，并再次通过构建与设备交付回归（`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 4 持续推进，完成 `VmEngine/app/src/main/cpp/zLinker.cpp`、`VmProtect/modules/elfkit/core/zFunction.cpp`、`VmEngine/app/build.gradle`、`demo/app/build.gradle` 注释增强（仅增注释不改逻辑），并再次通过构建与设备交付回归（`route4_regression PASS`、`demo_smoke PASS`、`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 4 持续推进，继续提升 `VmProtect/modules/elfkit/core/zFunction.cpp` case 分支级注释与 `VmProtect/modules/elfkit/core/zElfAbi.h` 分组注释密度，并再次通过构建与设备交付回归（`route4_regression PASS`、`demo_smoke PASS`、`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 4 持续推进，完成 `VmEngine/app/src/main/cpp/zVmOpcodes.cpp` 的辅助算子、调用分支、类型转换、原子操作等关键路径注释加密（仅增注释不改逻辑），并再次通过构建与设备交付回归（`route4_regression PASS`、`demo_smoke PASS`、`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 4 持续推进，完成 `VmEngine/app/src/main/res/drawable/ic_launcher_background.xml` 与 `demo/app/src/main/res/drawable/ic_launcher_background.xml` 网格矢量逐段中文注释增强，并再次通过构建与设备交付回归（`route4_regression PASS`、`demo_smoke PASS`、`DELIVERY_GATE PASS`）。
- 2026-02-25：修复 `VmEngine/app/src/main/res/layout/activity_main.xml`、`demo/app/src/main/res/layout/activity_main.xml`、`VmEngine/app/src/main/res/drawable/ic_launcher_foreground.xml`、`demo/app/src/main/res/drawable/ic_launcher_foreground.xml` 注释插入位置导致的 XML 语法错误（将标签属性区注释移到合法位置），并恢复交付回归通过（`route4_regression PASS`、`demo_smoke PASS`、`DELIVERY_GATE PASS`）。
- 2026-02-25：按第 7 节批次 B 完成 `VmProtect/modules/elfkit/core/zElfAbi.h` 与 `VmEngine/app/src/main/cpp/zLinker.cpp` 注释增强（仅增注释不改逻辑）；本轮统计 `zElfAbi.h` 注释密度提升到 `28.45%`、`zLinker.cpp` 提升到 `17.30%`，并再次通过构建与设备交付回归（`route4_regression PASS`、`demo_smoke PASS`、`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 C 持续推进，完成 `VmEngine/app/src/main/cpp/zLinker.h`、`VmEngine/app/src/main/cpp/zPatchBay.cpp`、`VmEngine/app/src/main/cpp/zPatchBay.h` 注释增强（仅增注释不改逻辑）；本轮统计 `zLinker.h` 提升到 `46.76%`、`zPatchBay.cpp` 提升到 `31.91%`、`zPatchBay.h` 提升到 `35.09%`，并再次通过构建与设备交付回归（`route4_regression PASS`、`demo_smoke PASS`、`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 C 收尾完成 `VmProtect/modules/elfkit/core/zElfLayout.cpp` 注释增强（仅增注释不改逻辑）；本轮统计注释密度提升到 `21.53%`，并再次通过构建与设备交付回归（`route4_regression PASS`、`demo_smoke PASS`、`DELIVERY_GATE PASS`）。
- 2026-02-25：批次 D 完成 `VmProtect/modules/elfkit/patchbayModel/zPatchElfValidatorDynamic.cpp` 与 `VmProtect/modules/elfkit/api/zElfKit.cpp` 注释增强（仅增注释不改逻辑）；本轮统计 `zPatchElfValidatorDynamic.cpp` 提升到 `21.93%`、`zElfKit.cpp` 提升到 `30.29%`，并再次通过构建与设备交付回归（`route4_regression PASS`、`demo_smoke PASS`、`DELIVERY_GATE PASS`）。
- 2026-02-25：继续按“1+2”批次提升 `VmProtect/modules/elfkit/core/zFunction.cpp` 与 `VmEngine/app/src/main/cpp/zVmOpcodes.cpp` 注释密度（仅增注释不改逻辑）；本轮统计 `zFunction.cpp` 提升到 `19.16%`、`zVmOpcodes.cpp` 提升到 `19.52%`，并再次通过构建与设备交付回归（`route4_regression PASS`、`demo_smoke PASS`、`DELIVERY_GATE PASS`）。
- 2026-02-25：继续按“1+2”批次二次加密注释，完成 `VmProtect/modules/elfkit/core/zFunction.cpp` 与 `VmEngine/app/src/main/cpp/zVmOpcodes.cpp` 的低密度窗口增强（仅增注释不改逻辑）；本轮统计 `zFunction.cpp` 提升到 `20.71%`、`zVmOpcodes.cpp` 提升到 `21.40%`，并再次通过构建与设备交付回归（`route4_regression PASS`、`demo_smoke PASS`、`DELIVERY_GATE PASS`）。

## 7. 下一阶段清单与计划（自动执行）
### 7.1 优先提升注释密度文件（按当前统计）
- `VmProtect/modules/elfkit/core/zFunction.cpp`
- `VmProtect/modules/elfkit/core/zElfAbi.h`
- `VmEngine/app/src/main/cpp/zLinker.cpp`
- `VmEngine/app/src/main/cpp/zVmOpcodes.cpp`
- `VmEngine/app/src/main/res/layout/activity_main.xml`
- `demo/app/src/main/res/layout/activity_main.xml`
- `VmEngine/app/src/main/res/drawable/ic_launcher_foreground.xml`
- `demo/app/src/main/res/drawable/ic_launcher_foreground.xml`

### 7.2 执行节奏
- 批次 A：`zFunction.cpp` + 两个 `activity_main.xml` + 两个 `ic_launcher_foreground.xml`。
- 批次 B：`zElfAbi.h` + `zLinker.cpp`。
- 批次 C：`zElfLayout.cpp` + `zLinker.h` + `zPatchBay.cpp/.h`（已完成）。
- 批次 D：`zPatchElfValidatorDynamic.cpp` + `zElfKit.cpp`（已完成）。
- 每个批次固定执行：`cmake --build VmProtect/cmake-build-debug --target VmProtect -j 12` 与 `python tools/run_delivery_check.py --project-root .`。
